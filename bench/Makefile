# ==================================================================================== #
# = Executable
# ==================================================================================== #

BIN = bench

# ==================================================================================== #
# = Compiler settings
# ==================================================================================== #

CC      = gcc
CFLAGS += -O3 -fno-tree-vectorize -std=c11
LIBS   += -lm -lcriterion

# ==================================================================================== #
# = Object / Assembly Files
# ==================================================================================== #

%.o : %.c
	$(CC) $(CFLAGS) -c $< -o $@

%.s : %.c
	$(CC) $(CFLAGS) -S $< -o $@

SRCS=$(wildcard *.c)

OBJS=$(SRCS:.c=.o)

# ==================================================================================== #
# = Targets
# ==================================================================================== #

ASMS=$(SRCS:.c=.s)

all: $(OBJS) $(ASMS)
	$(CC) $(OBJS) -o $(BIN) $(LIBS)

test:
	$(CC) $(CFLAGS) utils.c -o utils.test $(LIBS)
	./utils.test

clean:
	rm -rf *.o *.txt *.s *.test
	rm -rf $(BIN)
